# Taste of the End — Backend

REST API для застосунку з кулінарними рецептами. Підтримує реєстрацію, логін, керування сесіями, отримання профілю користувача, списків категорій та інгредієнтів, а також пошук рецептів.

## Стек

- Node.js 20+, Express 5
- MongoDB + Mongoose
- Celebrate/Joi для валідації
- Cookie-based сесії (зберігаються у MongoDB)

## Запуск

1. Встановіть залежності:
   ```bash
   npm install
   ```
2. Створіть `.env` та додайте мінімум такі змінні:
   ```env
   MONGO_URL=mongodb+srv://...
   NODE_ENV=development
   PORT=3030
   ```
3. Запустіть сервер:
   - розробка: `npm run dev`
   - продакшн: `npm start`

Під час старту застосунок підʼєднується до MongoDB (`src/db/connectMongoDB.js`) і після успішного конекту слухає порт `PORT` (за замовчуванням 3030).

## CORS та кукі

- Список дозволених originʼів формується у `src/constants/origins.js`.
- Кукі: `httpOnly`, `sameSite` = `none` у продакшні та `lax` у деві, `secure` = `true`, коли `NODE_ENV=production`.

## Структура (скорочено)

```
src/
├─ controllers/   // бізнес-логіка
├─ routes/        // HTTP-маршрути
├─ middleware/    // auth, логування, помилки
├─ models/        // Mongoose-схеми
├─ services/      // сесії тощо
└─ utils/
```

## Базовий URL

Усі ендпоінти доступні за префіксом `/api`.

## API

### Auth

| Метод/Шлях                | Призначення                     | Тіло запиту                                      | Основні відповіді |
| ------------------------- | ------------------------------- | ------------------------------------------------ | ----------------- |
| `POST /api/auth/register` | Реєстрація + створення сесії    | `{ name (≤16), email (≤128), password (8-128) }` | `201`, `409`      |
| `POST /api/auth/login`    | Логін, перевидача сесії         | `{ email, password }`                            | `200`, `401`      |
| `POST /api/auth/logout`   | Видалення поточної сесії        | —                                                | `204`, `401`      |
| `POST /api/auth/refresh`  | Оновлення access-токена за кукі | — (працює через `refreshToken` у кукі)           | `200`             |

### Users

| Метод/Шлях          | Опис                                |
| ------------------- | ----------------------------------- |
| `GET /api/users/me` | Повертає дані авторизованого юзера. |

### Categories

| Метод/Шлях            | Опис                                    |
| --------------------- | --------------------------------------- |
| `GET /api/categories` | Повертає масив назв категорій рецептів. |

### Ingredients

| Метод/Шлях             | Опис                                  |
| ---------------------- | ------------------------------------- |
| `GET /api/ingredients` | Повертає масив обʼєктів інгредієнтів. |

### Recipes

| Метод/Шлях                   | Опис                                                                                       | Параметри                                                                                                                |
| ---------------------------- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| `GET /api/recipes`           | Пагінований список рецептів. Повертає `page`, `perPage`, `total`, `totalPages`, `recipes`. | Query: `page` (default 1), `perPage` (default 12), `category`, `area`, `owner` (ObjectId), `search` (регекс по `title`). |
| `GET /api/recipes/:recipeId` | Деталі конкретного рецепта.                                                                | `400`, якщо id невалідний; `404`, якщо рецепт відсутній.                                                                 |

## Ручні тести

1. **Auth flow:** `register → login → refresh → logout` і перевірити кукі.
2. **Захищені роути:** запит `GET /api/users/me` з валідними/простроченими кукі.
3. **Категорії/інгредієнти:** переконатися у відповідності даних із БД.
4. **Рецепти:** протестувати фільтри та пагінацію.
